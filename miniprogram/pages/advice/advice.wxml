<view class="container">
  <!-- å®æ—¶æ±‡ç‡æ¦‚è§ˆ -->
  <view class="card overview-card">
    <view class="card-header">
      <view class="header-info">
        <text class="card-title">ğŸ’° å®æ—¶æ±‡ç‡</text>
        <text class="update-time">æ›´æ–°æ—¶é—´: {{lastUpdateTime}}</text>
      </view>
      <button class="refresh-btn" bindtap="refreshAllData">
        <text class="refresh-icon">ğŸ”„</text>
      </button>
    </view>
    <view class="card-body">
      <view class="market-overview">
        <view class="overview-stats">
          <view class="stat-item up">
            <text class="stat-value">{{marketStats.up}}</text>
            <text class="stat-label">ä¸Šæ¶¨</text>
          </view>
          <view class="stat-item down">
            <text class="stat-value">{{marketStats.down}}</text>
            <text class="stat-label">ä¸‹è·Œ</text>
          </view>
          <view class="stat-item flat">
            <text class="stat-value">{{marketStats.flat}}</text>
            <text class="stat-label">å¹³ç›˜</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{marketStats.total}}</text>
            <text class="stat-label">æ€»å¸ç§</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ±‡ç‡è®¡ç®—å™¨ -->
  <view class="card calculator-card">
    <view class="card-header">
      ğŸ§® æ±‡ç‡è®¡ç®—å™¨
    </view>
    <view class="card-body">
      <view class="calculator-section">
        <view class="calc-row">
          <view class="calc-input-group">
            <input class="calc-input" type="digit" value="{{calcFrom.amount}}" bindinput="onCalcFromInput" placeholder="0.00" />
            <picker bindchange="onCalcFromCurrencyChange" value="{{calcFrom.currencyIndex}}" range="{{currencies}}" range-key="name">
              <view class="calc-currency-picker">
                <text class="calc-flag">{{currencies[calcFrom.currencyIndex].flag}}</text>
                <text class="calc-code">{{currencies[calcFrom.currencyIndex].code}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
        
        <view class="calc-swap">
          <button class="swap-btn" bindtap="swapCalcCurrencies">
            <text class="swap-icon">â‡…</text>
          </button>
        </view>
        
        <view class="calc-row">
          <view class="calc-input-group">
            <input class="calc-input" type="digit" value="{{calcTo.amount}}" bindinput="onCalcToInput" placeholder="0.00" />
            <picker bindchange="onCalcToCurrencyChange" value="{{calcTo.currencyIndex}}" range="{{currencies}}" range-key="name">
              <view class="calc-currency-picker">
                <text class="calc-flag">{{currencies[calcTo.currencyIndex].flag}}</text>
                <text class="calc-code">{{currencies[calcTo.currencyIndex].code}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
        
        <view class="calc-info">
          <text class="calc-rate">æ±‡ç‡: 1 {{currencies[calcFrom.currencyIndex].code}} = {{calcRate}} {{currencies[calcTo.currencyIndex].code}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦è´§å¸æ±‡ç‡çœ‹æ¿ -->
  <view class="card rates-board">
    <view class="card-header">
      <text class="card-title">ğŸ“Š ä¸»è¦è´§å¸</text>
      <view class="sort-controls">
        <button class="sort-btn {{sortBy === 'name' ? 'active' : ''}}" bindtap="changeSortBy" data-sort="name">åç§°</button>
        <button class="sort-btn {{sortBy === 'rate' ? 'active' : ''}}" bindtap="changeSortBy" data-sort="rate">æ±‡ç‡</button>
        <button class="sort-btn {{sortBy === 'change' ? 'active' : ''}}" bindtap="changeSortBy" data-sort="change">æ¶¨è·Œ</button>
      </view>
    </view>
    <view class="card-body">
      <view class="currency-list">
        <view class="currency-item" wx:for="{{currencyRates}}" wx:key="code" bindtap="selectCurrency" data-currency="{{item}}">
          <view class="currency-basic">
            <text class="currency-flag">{{item.flag}}</text>
            <view class="currency-detail">
              <text class="currency-name">{{item.name}}</text>
              <text class="currency-code">{{item.code}}</text>
            </view>
          </view>
          <view class="currency-data">
            <text class="current-rate">{{item.rate}}</text>
            <view class="rate-change {{item.changeStatus}}">
              <text class="change-icon">{{item.changeIcon}}</text>
              <text class="change-value">{{item.change}}</text>
              <text class="change-percent">({{item.changePercent}}%)</text>
            </view>
          </view>
          <view class="currency-actions">
            <button class="action-btn monitor" bindtap="addToMonitor" data-currency="{{item}}" catchtap="">
              <text class="action-icon">ğŸ‘</text>
            </button>
            <button class="action-btn alert" bindtap="setAlert" data-currency="{{item}}" catchtap="">
              <text class="action-icon">ğŸ””</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- é“¶è¡Œæ±‡ç‡å¯¹æ¯” -->
  <view class="card bank-rates">
    <view class="card-header">
      ğŸ¦ é“¶è¡Œæ±‡ç‡å¯¹æ¯”
    </view>
    <view class="card-body">
      <view class="bank-selector">
        <picker bindchange="onBankCurrencyChange" value="{{bankCurrencyIndex}}" range="{{currencies}}" range-key="name">
          <view class="bank-currency-picker">
            <text class="picker-label">é€‰æ‹©è´§å¸:</text>
            <text class="picker-currency">{{currencies[bankCurrencyIndex].flag}} {{currencies[bankCurrencyIndex].name}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="bank-list">
        <view class="bank-header">
          <text class="bank-col-name">é“¶è¡Œ</text>
          <text class="bank-col-buy">ä¹°å…¥ä»·</text>
          <text class="bank-col-sell">å–å‡ºä»·</text>
          <text class="bank-col-spread">ä»·å·®</text>
        </view>
        <view class="bank-item" wx:for="{{bankRates}}" wx:key="name">
          <view class="bank-info">
            <text class="bank-icon">{{item.icon}}</text>
            <text class="bank-name">{{item.name}}</text>
          </view>
          <text class="bank-buy">{{item.buyRate}}</text>
          <text class="bank-sell">{{item.sellRate}}</text>
          <text class="bank-spread {{item.spreadStatus}}">{{item.spread}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ±‡ç‡èµ°åŠ¿å›¾è¡¨ -->
  <view class="card chart-card">
    <view class="card-header">
      <text class="card-title">ğŸ“ˆ {{selectedCurrency.flag}} {{selectedCurrency.name}} èµ°åŠ¿</text>
      <view class="chart-controls">
        <text class="time-tab {{timeRange === '1D' ? 'active' : ''}}" bindtap="changeTimeRange" data-range="1D">1æ—¥</text>
        <text class="time-tab {{timeRange === '7D' ? 'active' : ''}}" bindtap="changeTimeRange" data-range="7D">7æ—¥</text>
        <text class="time-tab {{timeRange === '30D' ? 'active' : ''}}" bindtap="changeTimeRange" data-range="30D">30æ—¥</text>
      </view>
    </view>
    <view class="card-body">
      <view class="chart-container">
        <view class="chart-wrapper">
          <view class="chart-line" wx:for="{{chartData}}" wx:key="index">
            <view class="chart-point" 
                  style="height: {{item.height}}%; background: {{item.color}};" 
                  bindtap="showChartPoint" 
                  data-point="{{item}}">
            </view>
            <text class="chart-label">{{item.label}}</text>
          </view>
        </view>
      </view>
      
      <view class="chart-summary">
        <view class="summary-item">
          <text class="summary-label">æœ€é«˜</text>
          <text class="summary-value high">{{chartSummary.high}}</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">æœ€ä½</text>
          <text class="summary-value low">{{chartSummary.low}}</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">æ³¢å¹…</text>
          <text class="summary-value">{{chartSummary.range}}%</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">å‡ä»·</text>
          <text class="summary-value">{{chartSummary.average}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¢æ±‡æˆæœ¬è®¡ç®— -->
  <view class="card cost-calculator">
    <view class="card-header">
      ğŸ’³ æ¢æ±‡æˆæœ¬è®¡ç®—
    </view>
    <view class="card-body">
      <view class="cost-inputs">
        <view class="cost-input-row">
          <text class="input-label">æ¢æ±‡é‡‘é¢:</text>
          <input class="cost-input" type="digit" value="{{costCalc.amount}}" bindinput="onCostAmountInput" placeholder="è¾“å…¥é‡‘é¢" />
          <text class="input-currency">{{currencies[calcFrom.currencyIndex].code}}</text>
        </view>
        
        <view class="cost-input-row">
          <text class="input-label">æ‰‹ç»­è´¹ç‡:</text>
          <input class="cost-input" type="digit" value="{{costCalc.feeRate}}" bindinput="onCostFeeInput" placeholder="0.5" />
          <text class="input-unit">%</text>
        </view>
      </view>
      
      <view class="cost-result">
        <view class="cost-breakdown">
          <view class="cost-item">
            <text class="cost-label">æ¢æ±‡é‡‘é¢</text>
            <text class="cost-value">{{costCalc.baseAmount}}</text>
          </view>
          <view class="cost-item">
            <text class="cost-label">æ‰‹ç»­è´¹</text>
            <text class="cost-value fee">{{costCalc.fee}}</text>
          </view>
          <view class="cost-item total">
            <text class="cost-label">æ€»æˆæœ¬</text>
            <text class="cost-value">{{costCalc.totalCost}}</text>
          </view>
          <view class="cost-item">
            <text class="cost-label">å®é™…åˆ°è´¦</text>
            <text class="cost-value received">{{costCalc.received}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ±‡ç‡æé†’å¿«é€Ÿè®¾ç½® -->
  <view class="card alerts-quick">
    <view class="card-header">
      ğŸ”” å¿«é€Ÿè®¾ç½®æé†’
    </view>
    <view class="card-body">
      <view class="quick-alerts">
        <view class="alert-preset" wx:for="{{alertPresets}}" wx:key="id" bindtap="setQuickAlert" data-preset="{{item}}">
          <view class="preset-content">
            <text class="preset-icon">{{item.icon}}</text>
            <view class="preset-info">
              <text class="preset-title">{{item.title}}</text>
              <text class="preset-desc">{{item.description}}</text>
            </view>
          </view>
          <text class="preset-arrow">â†’</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å®ç”¨å·¥å…·é›† -->
  <view class="card tools-card">
    <view class="card-header">
      ğŸ›  å®ç”¨å·¥å…·
    </view>
    <view class="card-body">
      <view class="tools-grid">
        <button class="tool-item" bindtap="goToRateHistory">
          <text class="tool-icon">ğŸ“Š</text>
          <text class="tool-name">å†å²æ±‡ç‡</text>
          <text class="tool-desc">æŸ¥çœ‹å†å²èµ°åŠ¿</text>
        </button>
        
        <button class="tool-item" bindtap="goToRateAlerts">
          <text class="tool-icon">â°</text>
          <text class="tool-name">æˆ‘çš„æé†’</text>
          <text class="tool-desc">ç®¡ç†æ±‡ç‡æé†’</text>
        </button>
        
        <button class="tool-item" bindtap="showRateComparison">
          <text class="tool-icon">âš–ï¸</text>
          <text class="tool-name">å¤šå¸ç§å¯¹æ¯”</text>
          <text class="tool-desc">æ¨ªå‘å¯¹æ¯”åˆ†æ</text>
        </button>
        
        <button class="tool-item" bindtap="showExchangeTips">
          <text class="tool-icon">ğŸ’¡</text>
          <text class="tool-name">æ¢æ±‡æŠ€å·§</text>
          <text class="tool-desc">çœé’±å°è´´å£«</text>
        </button>
        
        <button class="tool-item" bindtap="showBestTiming">
          <text class="tool-icon">ğŸ¯</text>
          <text class="tool-name">æœ€ä½³æ—¶æœº</text>
          <text class="tool-desc">æ¢æ±‡æ—¶æœºåˆ†æ</text>
        </button>
        
        <button class="tool-item" bindtap="exportRateData">
          <text class="tool-icon">ğŸ“¤</text>
          <text class="tool-name">æ•°æ®å¯¼å‡º</text>
          <text class="tool-desc">å¯¼å‡ºæ±‡ç‡è®°å½•</text>
        </button>
      </view>
    </view>
  </view>
</view> 