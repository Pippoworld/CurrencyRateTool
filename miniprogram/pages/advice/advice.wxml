<view class="container">
  <!-- æ±‡ç‡è®¡ç®—å™¨ -->
  <view class="card">
    <view class="card-header">
      ğŸ§® æ±‡ç‡è®¡ç®—å™¨
    </view>
    <view class="card-body">
      <view class="calculator-section">
        <!-- åŸºç¡€è´§å¸è¾“å…¥ -->
        <view class="currency-input-row">
          <picker bindchange="onBaseCurrencyChange" value="{{baseCurrencyIndex}}" range="{{currencies}}" range-key="name">
            <view class="currency-selector">
              <text class="currency-flag">{{currencies[baseCurrencyIndex].flag}}</text>
              <text class="currency-code">{{currencies[baseCurrencyIndex].code}}</text>
              <text class="currency-name">{{currencies[baseCurrencyIndex].name}}</text>
              <text class="selector-arrow">â–¼</text>
            </view>
          </picker>
          <input 
            class="amount-input" 
            type="digit" 
            value="{{baseAmount}}" 
            bindinput="onBaseAmountInput"
            placeholder="100"
            maxlength="15"
          />
        </view>
        
        <!-- è®¡ç®—ç»“æœæç¤º -->
        <view class="calc-tip" wx:if="{{baseAmount}}">
          <text class="tip-text">{{baseAmount}} {{currencies[baseCurrencyIndex].code}} å¯ä»¥å…‘æ¢ï¼š</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¤šå›½æ±‡ç‡å¯¹æ¯” -->
  <view class="card">
    <view class="card-header rates-comparison-header">
      <view class="title-with-info">
        <text class="card-title">ğŸ’± å¤šå›½æ±‡ç‡å¯¹æ¯”</text>
        <button class="info-btn" bindtap="showUpdateTime">
          <text class="info-icon">â“˜</text>
        </button>
      </view>
      <button class="refresh-btn" bindtap="refreshRates" disabled="{{isRefreshing}}">
        <text class="refresh-icon {{isRefreshing ? 'spinning' : ''}}">ğŸ”„</text>
      </button>
    </view>
    <view class="card-body">
      <!-- æ±‡ç‡åˆ—è¡¨ -->
      <view class="rates-list">
        <view class="rate-item" wx:for="{{ratesList}}" wx:key="code" wx:if="{{item.code !== currencies[baseCurrencyIndex].code}}">
          <view class="rate-info">
            <view class="currency-basic">
              <text class="rate-flag">{{item.flag}}</text>
              <view class="currency-detail">
                <text class="rate-code">{{item.code}}</text>
                <text class="rate-name">{{item.name}}</text>
              </view>
            </view>
            <view class="rate-values">
              <text class="rate-value">{{item.displayRate}}</text>
              <text class="calculated-amount" wx:if="{{baseAmount}}">{{item.calculatedAmount}}</text>
            </view>
          </view>
          <view class="rate-change {{item.trend}}">
            <text class="change-icon">{{item.changeIcon}}</text>
            <text class="change-percent">{{item.changePercent}}%</text>
          </view>
        </view>
      </view>
      
      <!-- æ·»åŠ æ›´å¤šè´§å¸ -->
      <view class="add-currency-section">
        <button class="add-currency-btn" bindtap="showCurrencySelector">
          <text class="add-icon">â•</text>
          <text class="add-text">æ·»åŠ æ›´å¤šè´§å¸å¯¹æ¯”</text>
        </button>
      </view>
    </view>
  </view>

  <!-- æ±‡ç‡èµ°åŠ¿ï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
  <view class="card" wx:if="{{selectedCurrency}}">
    <view class="card-header">
      ğŸ“ˆ {{selectedCurrency.flag}} {{selectedCurrency.name}} èµ°åŠ¿
    </view>
    <view class="card-body">
      <view class="chart-container">
        <view class="chart-wrapper">
          <view class="chart-bar" wx:for="{{chartData}}" wx:key="index"
                style="height: {{item.height}}%; background: {{item.color}};" 
                bindtap="showRateDetail" data-point="{{item}}">
          </view>
        </view>
        <view class="chart-labels">
          <text class="chart-label" wx:for="{{chartLabels}}" wx:key="index">{{item}}</text>
        </view>
      </view>
      
      <view class="chart-stats">
        <view class="stat-item">
          <text class="stat-label">æœ€é«˜</text>
          <text class="stat-value high">{{chartStats.high}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">æœ€ä½</text>
          <text class="stat-value low">{{chartStats.low}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">å½“å‰</text>
          <text class="stat-value current">{{chartStats.current}}</text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- æ—¶é—´ä¿¡æ¯å¼¹çª— -->
<view class="time-modal" wx:if="{{showTimeModal}}" bindtap="hideTimeModal">
  <view class="time-modal-content" catchtap="">
    <view class="time-modal-title">æ•°æ®æ›´æ–°æ—¶é—´</view>
    <view class="time-modal-text">{{lastUpdateTime}}</view>
    <button class="time-modal-close" bindtap="hideTimeModal">ç¡®å®š</button>
  </view>
</view>

<!-- è´§å¸é€‰æ‹©å¼¹çª— -->
<view class="currency-modal" wx:if="{{showCurrencyModal}}" bindtap="hideCurrencySelector">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©è´§å¸</text>
      <button class="modal-close" bindtap="hideCurrencySelector">âœ•</button>
    </view>
    <view class="modal-body">
      <view class="currency-grid">
        <view class="currency-option" 
              wx:for="{{allCurrencies}}" 
              wx:key="code"
              wx:if="{{!selectedCurrencies[item.code]}}"
              bindtap="addCurrency" 
              data-currency="{{item}}">
          <text class="option-flag">{{item.flag}}</text>
          <text class="option-code">{{item.code}}</text>
          <text class="option-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>
</view> 